<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/dashboard.css" />
    <link rel="stylesheet" href="css/new_project_sheet.css" />
    <link rel="stylesheet" href="css/dashboard-notifications.css" />
    <link rel="stylesheet" href="css/dashboard-premium.css" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
    />
  </head>
  <body>
    <div class="container">
      <header>
        <div class="profile">
          <img src="../imgs/profile-pic.png" alt="Profile" class="profile-pic" />
          <div class="profile-info">
            <p class="hello">Hello Sarah ðŸ‘‹</p>
            <p class="my-space">My space</p>
          </div>
        </div>
        <div class="actions">
          <button type="button" class="premium-link" id="btn-premium" aria-label="Open premium" style="background:none; border:none; padding:0; cursor:pointer; color:inherit;">
            <span class="material-symbols-outlined">diamond</span>
          </button>
          <button type="button" class="notification-link" id="btn-notifications" aria-label="Notifications" style="background:none; border:none; padding:0; cursor:pointer; color:inherit;">
            <span class="material-symbols-outlined">notifications</span>
          </button>
        </div>
      </header>

      <main>
        <section class="project-overview">
          <h2>Project Overview</h2>
          <div class="overview-cards">
            <div class="card">
              <span class="material-symbols-outlined card-icon">folder</span>
              <p class="card-number">12</p>
              <p class="card-label">Active Projects</p>
            </div>
            <div class="card">
              <span class="material-symbols-outlined card-icon">schedule</span>
              <p class="card-number">32h</p>
              <p class="card-label">Hours Logged This Week</p>
            </div>
            <div class="card">
              <span class="material-symbols-outlined card-icon">
                task_alt
              </span>
              <p class="card-number">08</p>
              <p class="card-label">Tasks Complete</p>
            </div>
          </div>
        </section>

        <section class="jump-back-in">
          <h2>Jump back in</h2>
          <div class="recent-projects">
            <div class="project-card" onclick="openProject('image', 'img/room_2D.png', 'img/room_3D.png')">
              <img
                src="../../Web App/imgs/dashboard-normal/living-room-scandi.jpg"
                alt="Living room ver1"
              />
              <p>Living room ver1</p>
            </div>
            <div class="project-card" onclick="openProject('image', 'img/room_2D.png', 'img/room_3D.png')">
              <img
                src="../../Web App/imgs/dashboard-normal/living-room-modern.jpg"
                alt="Living room ver2"
              />
              <p>Living room ver2</p>
            </div>
            <div class="project-card draft" onclick="openProject('empty')">
              <div class="draft-box"></div>
              <p>Draft Test</p>
            </div>
          </div>
        </section>

        <section class="trending-ideas">
          <h2>Trending Ideas</h2>
          <div class="ideas-grid">
            <div class="idea-card" onclick="window.location.href='choose-template.html?tab=livingroom'">
              <img
                src="../../Web App/imgs/dashboard-normal/living-room-japandi.jpg"
                alt="Modern Living Room"
              />
              <p>Modern Living Room</p>
            </div>
            <div class="idea-card" onclick="window.location.href='choose-template.html?tab=bedroom'">
              <img
                src="../../Web App/imgs/dashboard-normal/bright-boho-office.jpg"
                alt="Cozy Bedroom"
              />
              <p>Cozy Bedroom</p>
            </div>
            <div class="idea-card" onclick="window.location.href='choose-template.html?tab=kitchen'">
              <img
                src="../../Web App/imgs/dashboard-normal/kitchen-scandi.jpg"
                alt="Japandi room"
              />
              <p>Japandi Room</p>
            </div>
            <div class="idea-card" onclick="window.location.href='choose-template.html?tab=office'">
              <img
                src="../../Web App/imgs/dashboard-normal/office-minimalism.jpg"
                alt="Minimalism Room"
              />
              <p>Minimalism Room</p>
            </div>
          </div>
        </section>
      </main>
    </div>

    
    <footer>
      <a href="#" class="fab" id="btn-add-project" aria-label="Create project">
        <span class="material-symbols-outlined">add</span>
      </a>
      <nav class="bottom-nav">
        <div class="nav-section left">
          <a href="dashboard.html" class="nav-item active">
            <span class="material-symbols-outlined">home</span>
            <p>Dashboard</p>
          </a>
          <a href="my-projects.html" class="nav-item">
            <span class="material-symbols-outlined">construction</span>
            <p>My Projects</p>
          </a>
          <a href="my_profile.html" class="nav-item">
            <span class="material-symbols-outlined">person</span>
            <p>Profile</p>
          </a>
        </div>
      </nav>
    </footer>

    <!-- Premium Overlay -->
    <div class="premium-overlay-backdrop" id="premiumBackdrop" hidden></div>
    <div class="premium-overlay" id="premiumOverlay" role="dialog" aria-modal="true" aria-labelledby="premiumTitle" hidden>
      <header class="premium-overlay__header">
        <h2 id="premiumTitle">Upgrade Plan</h2>
        <button class="premium-overlay__close" type="button" aria-label="Close premium">
          <span class="material-symbols-outlined">close</span>
        </button>
      </header>
      <div class="premium-overlay__content">
        <section class="plan-card" aria-label="Premium plan">
          <h2 class="plan-title">Premium</h2>
          <p class="plan-price"><span class="currency">$</span> 4.99 <span class="per">/ month</span></p>
          <p class="plan-sub">Pay 59.99 annually or 19.99 per month</p>
          <a class="buy-btn" href="#" role="button">Buy</a>

          <ul class="plan-features" aria-label="Premium features">
            <li>
              <span class="material-symbols-outlined check" aria-hidden="true">check</span>
              <span>Access to AI Designer and Smart Wizard tools to automate project creation</span>
            </li>
            <li>
              <span class="material-symbols-outlined check" aria-hidden="true">check</span>
              <span>Access to the list of 8K+ premium furniture items</span>
            </li>
            <li>
              <span class="material-symbols-outlined check" aria-hidden="true">check</span>
              <span>Automatic plan recognition to create a 3D from your file or image</span>
            </li>
          </ul>
        </section>

        <section class="plan-card" aria-label="Professional plan">
          <h2 class="plan-title">Professional</h2>
          <p class="plan-price"><span class="currency">$</span> 33.33 <span class="per">/ month</span></p>
          <p class="plan-sub">Pay 399.99 annually or 49.99 per month</p>
          <a class="buy-btn" href="#" role="button">Buy</a>

          <ul class="plan-features" aria-label="Professional features">
            <li>
              <span class="material-symbols-outlined check" aria-hidden="true">check</span>
              <span>Unlimited 4K renders of realistic and professional quality</span>
            </li>
            <li>
              <span class="material-symbols-outlined check" aria-hidden="true">check</span>
              <span>Upload your 3D models in formats .obj, .fbx, .blend, .stl...</span>
            </li>
            <li>
              <span class="material-symbols-outlined check" aria-hidden="true">check</span>
              <span>Moodboards to visually organize ideas</span>
            </li>
          </ul>
        </section>
      </div>
    </div>

    <!-- Notification Overlay -->
    <div class="notification-overlay-backdrop" id="notificationBackdrop" hidden></div>
    <div class="notification-overlay" id="notificationOverlay" role="dialog" aria-modal="true" aria-labelledby="notifTitle" hidden>
      <header class="notification-overlay__header">
        <h2 id="notifTitle">Notifications</h2>
        <button class="notification-overlay__close" type="button" aria-label="Close notifications">
          <span class="material-symbols-outlined">close</span>
        </button>
      </header>
      <div class="notification-overlay__content">
        <div class="notification-item">
          <div class="notification-header">
            <span class="red-dot"></span>
            <button type="button" class="notification-from-link" data-open-editor="true">From alexander36</button>
          </div>
          <div class="notification-body">
            <span class="material-symbols-outlined">person</span>
            <p>Has changed design <strong>Newdesign1</strong></p>
          </div>
        </div>
        <div class="notification-item">
          <div class="notification-header">
            <span>From Jake</span>
          </div>
          <div class="notification-body">
            <span class="material-symbols-outlined">manage_accounts</span>
            <p>Remind you of new changes on <strong>Newdesign2</strong></p>
          </div>
        </div>
      </div>
    </div>

    <!-- Bottom sheet: Start new project (homeuser dashboard) -->
    <div class="new-project-sheet-backdrop" hidden></div>
    <section
      class="new-project-sheet"
      role="dialog"
      aria-modal="true"
      aria-labelledby="newProjectSheetTitle"
      hidden
    >
      <header class="new-project-sheet__header">
        <button class="new-project-sheet__close" type="button" aria-label="Close">
          <span class="material-symbols-outlined" aria-hidden="true">close</span>
        </button>
        <h2 id="newProjectSheetTitle">Start new project</h2>
        <span class="new-project-sheet__header-spacer" aria-hidden="true"></span>
      </header>

      <div class="new-project-sheet__content">
        <a class="new-project-sheet__option" href="choose-template.html">
          <span class="new-project-sheet__icon" aria-hidden="true">
            <span class="material-symbols-outlined">grid_view</span>
          </span>
          <span class="new-project-sheet__text">
            <span class="new-project-sheet__title">Start with a template</span>
            <span class="new-project-sheet__subtitle">
              Start from a professionally designed template. Make it your own.
            </span>
          </span>
        </a>

        <div class="new-project-sheet__option" onclick="window.location.href='generate_architect.html'">
          <span class="new-project-sheet__icon" aria-hidden="true">
            <span class="material-symbols-outlined">auto_awesome</span>
          </span>
          <span class="new-project-sheet__text">
            <span class="new-project-sheet__title">Generate from prompt</span>
            <span class="new-project-sheet__subtitle">
              Tell us your idea, and we'll turn it into a ready-to-use design.
            </span>
          </span>
        </div>
      </div>
    </section>

    <!-- Bottom sheet: Start new project (Architect) -->
    <section
      class="new-project-sheet new-project-sheet-architect"
      role="dialog"
      aria-modal="true"
      aria-labelledby="newProjectSheetTitleArch"
      hidden
    >
      <header class="new-project-sheet__header">
        <button class="new-project-sheet__close close-arch" type="button" aria-label="Close">
          <span class="material-symbols-outlined" aria-hidden="true">close</span>
        </button>
        <h2 id="newProjectSheetTitleArch">Start new project</h2>
        <span class="new-project-sheet__header-spacer" aria-hidden="true"></span>
      </header>

      <div class="new-project-sheet__content">
        <!-- Option 1: Build from scratch -->
        <div class="new-project-sheet__option" onclick="window.location.href='editor_architect.html'">
          <span class="new-project-sheet__icon" aria-hidden="true">
            <span class="material-symbols-outlined">draw</span>
          </span>
          <span class="new-project-sheet__text">
            <span class="new-project-sheet__title">Build from scratch</span>
            <span class="new-project-sheet__subtitle">
              Design a custom plan from scratch using your own ideas.
            </span>
          </span>
        </div>

        <!-- Option 2: Start with a template -->
        <div class="new-project-sheet__option" onclick="window.location.href='choose-template.html'">
          <span class="new-project-sheet__icon" aria-hidden="true">
            <span class="material-symbols-outlined">grid_view</span>
          </span>
          <span class="new-project-sheet__text">
            <span class="new-project-sheet__title">Start with a template</span>
            <span class="new-project-sheet__subtitle">
              Start from a professionally designed template and make it your own.
            </span>
          </span>
        </div>

        <!-- Option 3: Generate from prompt -->
        <div class="new-project-sheet__option" onclick="window.location.href='generate_architect.html'">
          <span class="new-project-sheet__icon" aria-hidden="true">
            <span class="material-symbols-outlined">auto_awesome</span>
          </span>
          <span class="new-project-sheet__text">
            <span class="new-project-sheet__title">Generate from prompt</span>
            <span class="new-project-sheet__subtitle">
              Tell us your idea, and weâ€™ll turn it into a ready-to-use design.
            </span>
          </span>
        </div>
      </div>
    </section>

    <script>
      // Global function for project navigation
      window.openProject = (type, imageSrc, imageSrc3D) => {
        const role = localStorage.getItem('user_role');
        const editorPage = role === 'architect' ? 'editor_architect.html' : 'editor_normaluser.html';
        
        let url = editorPage;
        if (type === 'image' && imageSrc) {
          url += `?mode=image&src=${encodeURIComponent(imageSrc)}`;
          if (imageSrc3D) {
            url += `&src3d=${encodeURIComponent(imageSrc3D)}`;
          }
        } else {
          url += `?mode=empty`;
        }
        
        window.location.href = url;
      };

      document.addEventListener('DOMContentLoaded', () => {
        const role = localStorage.getItem('user_role');
        const fab = document.getElementById('btn-add-project');
        
        // Elements for Homeuser Sheet
        const sheetHome = document.querySelector('.new-project-sheet:not(.new-project-sheet-architect)');
        const closeBtnHome = sheetHome ? sheetHome.querySelector('.new-project-sheet__close') : null;

        // Elements for Architect Sheet
        const sheetArch = document.querySelector('.new-project-sheet-architect');
        const closeBtnArch = sheetArch ? sheetArch.querySelector('.new-project-sheet__close') : null;

        const backdrop = document.querySelector('.new-project-sheet-backdrop');

        if (!backdrop || !fab) return;

        let lastActiveElement = null;
        let isOpen = false;
        let activeSheet = null;

        const openSheet = (sheetToOpen) => {
          if (isOpen || !sheetToOpen) return;
          isOpen = true;
          activeSheet = sheetToOpen;
          lastActiveElement = fab || document.activeElement;

          backdrop.hidden = false;
          activeSheet.hidden = false;
          document.body.classList.add('new-project-sheet--lock');

          requestAnimationFrame(() => {
            backdrop.classList.add('is-open');
            activeSheet.classList.add('is-open');
            
            // Focus close button
            const closeBtn = activeSheet.querySelector('.new-project-sheet__close');
            if (closeBtn) closeBtn.focus();
          });
        };

        const closeSheet = () => {
          if (!isOpen || !activeSheet) return;
          isOpen = false;
          
          backdrop.classList.remove('is-open');
          activeSheet.classList.remove('is-open');
          document.body.classList.remove('new-project-sheet--lock');

          const currentSheet = activeSheet; // Capture for closure
          const finish = () => {
            backdrop.hidden = true;
            currentSheet.hidden = true;
            currentSheet.removeEventListener('transitionend', finish);
            if (lastActiveElement && typeof lastActiveElement.focus === 'function') {
              lastActiveElement.focus();
            }
            activeSheet = null;
          };

          activeSheet.addEventListener('transitionend', finish);
        };

        fab.addEventListener('click', (e) => {
          e.preventDefault();
          if (role === 'architect') {
            openSheet(sheetArch);
          } else {
            openSheet(sheetHome);
          }
        });

        if (closeBtnHome) closeBtnHome.addEventListener('click', closeSheet);
        if (closeBtnArch) closeBtnArch.addEventListener('click', closeSheet);
        backdrop.addEventListener('click', closeSheet);
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') closeSheet();
        });

        // --- Notification Overlay Logic ---
        const notifBtn = document.getElementById('btn-notifications');
        const notifOverlay = document.getElementById('notificationOverlay');
        const notifBackdrop = document.getElementById('notificationBackdrop');
        const notifClose = notifOverlay ? notifOverlay.querySelector('.notification-overlay__close') : null;

        if (notifBtn && notifOverlay && notifBackdrop) {
          let isNotifOpen = false;

          const openNotif = () => {
            if (isNotifOpen) return;
            isNotifOpen = true;
            notifBackdrop.hidden = false;
            notifOverlay.hidden = false;
            
            requestAnimationFrame(() => {
              notifBackdrop.classList.add('is-open');
              notifOverlay.classList.add('is-open');
            });
          };

          const closeNotif = () => {
            if (!isNotifOpen) return;
            isNotifOpen = false;
            notifBackdrop.classList.remove('is-open');
            notifOverlay.classList.remove('is-open');

            const finish = () => {
              notifBackdrop.hidden = true;
              notifOverlay.hidden = true;
              notifOverlay.removeEventListener('transitionend', finish);
            };
            notifOverlay.addEventListener('transitionend', finish);
          };

          notifBtn.addEventListener('click', (e) => {
            e.preventDefault();
            openNotif();
          });

          if (notifClose) notifClose.addEventListener('click', closeNotif);
          notifBackdrop.addEventListener('click', closeNotif);
        }

        // --- Notification: role-aware editor navigation ---
        document.querySelectorAll('[data-open-editor="true"]').forEach((el) => {
          el.addEventListener('click', (e) => {
            e.preventDefault();
            const role = localStorage.getItem('user_role');
            const editorPage = role === 'architect' ? 'editor_architect.html' : 'editor_normaluser.html';
            window.location.href = editorPage;
          });
        });

        // --- Premium Overlay Logic ---
        const premiumBtn = document.getElementById('btn-premium');
        const premiumOverlay = document.getElementById('premiumOverlay');
        const premiumBackdrop = document.getElementById('premiumBackdrop');
        const premiumClose = premiumOverlay ? premiumOverlay.querySelector('.premium-overlay__close') : null;

        if (premiumBtn && premiumOverlay && premiumBackdrop) {
          let isPremiumOpen = false;

          const openPremium = () => {
            if (isPremiumOpen) return;
            isPremiumOpen = true;
            premiumBackdrop.hidden = false;
            premiumOverlay.hidden = false;
            
            requestAnimationFrame(() => {
              premiumBackdrop.classList.add('is-open');
              premiumOverlay.classList.add('is-open');
            });
          };

          const closePremium = () => {
            if (!isPremiumOpen) return;
            isPremiumOpen = false;
            premiumBackdrop.classList.remove('is-open');
            premiumOverlay.classList.remove('is-open');

            const finish = () => {
              premiumBackdrop.hidden = true;
              premiumOverlay.hidden = true;
              premiumOverlay.removeEventListener('transitionend', finish);
            };
            premiumOverlay.addEventListener('transitionend', finish);
          };

          premiumBtn.addEventListener('click', (e) => {
            e.preventDefault();
            openPremium();
          });

          if (premiumClose) premiumClose.addEventListener('click', closePremium);
          premiumBackdrop.addEventListener('click', closePremium);

          // Auto-open based on hash
          if (window.location.hash === '#premium') {
            openPremium();
            // Clean hash
            history.replaceState(null, null, ' ');
          }
        }
      });
    </script>
  </body>
</html>