<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/dashboard.css" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
    />
    <link rel="stylesheet" href="css/new_project_sheet.css" />
  </head>
  <body>
    <div class="container">
      <header>
        <div class="profile">
          <img src="../imgs/profile-pic.png" alt="Profile" class="profile-pic" />
          <div class="profile-info">
            <p class="hello">Hello Sarah ðŸ‘‹</p>
            <p class="my-space">My space</p>
          </div>
        </div>
        <div class="actions">
          <a href="premium.html" class="premium-link" aria-label="Open premium">
            <span class="material-symbols-outlined">diamond</span>
          </a>
          <a href="notifications.html" class="notification-link">
            <span class="material-symbols-outlined">notifications</span>
          </a>
        </div>
      </header>

      <main>
        <section class="project-overview">
          <h2>Project Overview</h2>
          <div class="overview-cards">
            <div class="card">
              <span class="material-symbols-outlined card-icon">folder</span>
              <p class="card-number">12</p>
              <p class="card-label">Active Projects</p>
            </div>
            <div class="card">
              <span class="material-symbols-outlined card-icon">schedule</span>
              <p class="card-number">32h</p>
              <p class="card-label">Hours Logged This Week</p>
            </div>
            <div class="card">
              <span class="material-symbols-outlined card-icon">
                task_alt
              </span>
              <p class="card-number">08</p>
              <p class="card-label">Tasks Complete</p>
            </div>
          </div>
        </section>

        <section class="jump-back-in">
          <h2>Jump back in</h2>
          <div class="recent-projects">
            <div class="project-card">
              <img
                src="../../Web App/imgs/dashboard-normal/living-room-scandi.jpg"
                alt="Living room ver1"
              />
              <p>Living room ver1</p>
            </div>
            <div class="project-card">
              <img
                src="../../Web App/imgs/dashboard-normal/living-room-modern.jpg"
                alt="Living room ver2"
              />
              <p>Living room ver2</p>
            </div>
            <div class="project-card draft">
              <div class="draft-box"></div>
              <p>Draft Test</p>
            </div>
          </div>
        </section>

        <section class="trending-ideas">
          <h2>Trending Ideas</h2>
          <div class="ideas-grid">
            <div class="idea-card">
              <img
                src="../../Web App/imgs/dashboard-normal/living-room-japandi.jpg"
                alt="Modern Living Room"
              />
              <p>Modern Living Room</p>
            </div>
            <div class="idea-card">
              <img
                src="../../Web App/imgs/dashboard-normal/bright-boho-office.jpg"
                alt="Cozy Bedroom"
              />
              <p>Cozy Bedroom</p>
            </div>
            <div class="idea-card">
              <img
                src="../../Web App/imgs/dashboard-normal/kitchen-scandi.jpg"
                alt="Japandi room"
              />
              <p>Japandi Room</p>
            </div>
            <div class="idea-card">
              <img
                src="../../Web App/imgs/dashboard-normal/office-minimalism.jpg"
                alt="Minimalism Room"
              />
              <p>Minimalism Room</p>
            </div>
          </div>
        </section>
      </main>
    </div>

    
    <footer>
      <a href="#" class="fab" id="btn-add-project" aria-label="Create project">
        <span class="material-symbols-outlined">add</span>
      </a>
      <nav class="bottom-nav">
        <div class="nav-section left">
          <a href="dashboard.html" class="nav-item active">
            <span class="material-symbols-outlined">home</span>
            <p>Dashboard</p>
          </a>
          <a href="my-projects.html" class="nav-item">
            <span class="material-symbols-outlined">construction</span>
            <p>My Projects</p>
          </a>
          <a href="my_profile.html" class="nav-item">
            <span class="material-symbols-outlined">person</span>
            <p>Profile</p>
          </a>
        </div>
      </nav>
    </footer>

    <!-- Bottom sheet: Start new project (homeuser dashboard) -->
    <div class="new-project-sheet-backdrop" hidden></div>
    <section
      class="new-project-sheet"
      role="dialog"
      aria-modal="true"
      aria-labelledby="newProjectSheetTitle"
      hidden
    >
      <header class="new-project-sheet__header">
        <button class="new-project-sheet__close" type="button" aria-label="Close">
          <span class="material-symbols-outlined" aria-hidden="true">close</span>
        </button>
        <h2 id="newProjectSheetTitle">Start new project</h2>
        <span class="new-project-sheet__header-spacer" aria-hidden="true"></span>
      </header>

      <div class="new-project-sheet__content">
        <a class="new-project-sheet__option" href="choose-template.html">
          <span class="new-project-sheet__icon" aria-hidden="true">
            <span class="material-symbols-outlined">grid_view</span>
          </span>
          <span class="new-project-sheet__text">
            <span class="new-project-sheet__title">Start with a template</span>
            <span class="new-project-sheet__subtitle">
              Start from a professionally designed template. Make it your own.
            </span>
          </span>
        </a>

        <button class="new-project-sheet__option" type="button">
          <span class="new-project-sheet__icon" aria-hidden="true">
            <span class="material-symbols-outlined">auto_awesome</span>
          </span>
          <span class="new-project-sheet__text">
            <span class="new-project-sheet__title">Generate from prompt</span>
            <span class="new-project-sheet__subtitle">
              Tell us your idea, and we'll turn it into a ready-to-use design.
            </span>
          </span>
        </button>
      </div>
    </section>

    <!-- Bottom sheet: Start new project (Architect) -->
    <section
      class="new-project-sheet new-project-sheet-architect"
      role="dialog"
      aria-modal="true"
      aria-labelledby="newProjectSheetTitleArch"
      hidden
    >
      <header class="new-project-sheet__header">
        <button class="new-project-sheet__close close-arch" type="button" aria-label="Close">
          <span class="material-symbols-outlined" aria-hidden="true">close</span>
        </button>
        <h2 id="newProjectSheetTitleArch">Start new project</h2>
        <span class="new-project-sheet__header-spacer" aria-hidden="true"></span>
      </header>

      <div class="new-project-sheet__content">
        <!-- Option 1: Build from scratch -->
        <div class="new-project-sheet__option" onclick="window.location.href='editor_architect.html'">
          <span class="new-project-sheet__icon" aria-hidden="true">
            <span class="material-symbols-outlined">draw</span>
          </span>
          <span class="new-project-sheet__text">
            <span class="new-project-sheet__title">Build from scratch</span>
            <span class="new-project-sheet__subtitle">
              Design a custom plan from scratch using your own ideas.
            </span>
          </span>
        </div>

        <!-- Option 2: Start with a template -->
        <div class="new-project-sheet__option" onclick="window.location.href='choose-template.html'">
          <span class="new-project-sheet__icon" aria-hidden="true">
            <span class="material-symbols-outlined">grid_view</span>
          </span>
          <span class="new-project-sheet__text">
            <span class="new-project-sheet__title">Start with a template</span>
            <span class="new-project-sheet__subtitle">
              Start from a professionally designed template and make it your own.
            </span>
          </span>
        </div>

        <!-- Option 3: Generate from prompt -->
        <div class="new-project-sheet__option" onclick="window.location.href='generate_architect.html'">
          <span class="new-project-sheet__icon" aria-hidden="true">
            <span class="material-symbols-outlined">auto_awesome</span>
          </span>
          <span class="new-project-sheet__text">
            <span class="new-project-sheet__title">Generate from prompt</span>
            <span class="new-project-sheet__subtitle">
              Tell us your idea, and weâ€™ll turn it into a ready-to-use design.
            </span>
          </span>
        </div>
      </div>
    </section>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const role = localStorage.getItem('user_role');
        const fab = document.getElementById('btn-add-project');
        
        // Elements for Homeuser Sheet
        const sheetHome = document.querySelector('.new-project-sheet:not(.new-project-sheet-architect)');
        const closeBtnHome = sheetHome ? sheetHome.querySelector('.new-project-sheet__close') : null;

        // Elements for Architect Sheet
        const sheetArch = document.querySelector('.new-project-sheet-architect');
        const closeBtnArch = sheetArch ? sheetArch.querySelector('.new-project-sheet__close') : null;

        const backdrop = document.querySelector('.new-project-sheet-backdrop');

        if (!backdrop || !fab) return;

        let lastActiveElement = null;
        let isOpen = false;
        let activeSheet = null;

        const openSheet = (sheetToOpen) => {
          if (isOpen || !sheetToOpen) return;
          isOpen = true;
          activeSheet = sheetToOpen;
          lastActiveElement = fab || document.activeElement;

          backdrop.hidden = false;
          activeSheet.hidden = false;
          document.body.classList.add('new-project-sheet--lock');

          requestAnimationFrame(() => {
            backdrop.classList.add('is-open');
            activeSheet.classList.add('is-open');
            
            // Focus close button
            const closeBtn = activeSheet.querySelector('.new-project-sheet__close');
            if (closeBtn) closeBtn.focus();
          });
        };

        const closeSheet = () => {
          if (!isOpen || !activeSheet) return;
          isOpen = false;
          
          backdrop.classList.remove('is-open');
          activeSheet.classList.remove('is-open');
          document.body.classList.remove('new-project-sheet--lock');

          const currentSheet = activeSheet; // Capture for closure
          const finish = () => {
            backdrop.hidden = true;
            currentSheet.hidden = true;
            currentSheet.removeEventListener('transitionend', finish);
            if (lastActiveElement && typeof lastActiveElement.focus === 'function') {
              lastActiveElement.focus();
            }
            activeSheet = null;
          };

          activeSheet.addEventListener('transitionend', finish);
        };

        fab.addEventListener('click', (e) => {
          e.preventDefault();
          if (role === 'architect') {
            openSheet(sheetArch);
          } else {
            openSheet(sheetHome);
          }
        });

        if (closeBtnHome) closeBtnHome.addEventListener('click', closeSheet);
        if (closeBtnArch) closeBtnArch.addEventListener('click', closeSheet);
        backdrop.addEventListener('click', closeSheet);
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') closeSheet();
        });
      });
    </script>
  </body>
</html>